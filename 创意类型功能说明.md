# 创意类型功能说明

## 📋 功能概述

为创意（Idea）添加了创意类型分类功能，用于对不同类型的创新想法进行分类管理。

## 🎯 创意类型定义

系统定义了以下 6 种创意类型：

| 类型代码 | 类型名称 | 说明 |
|---------|---------|------|
| `TECH_INNOVATION` | 技术创新 | 技术方案、技术改进等 |
| `PRODUCT_INNOVATION` | 产品创新 | 新产品、新功能等 |
| `PROCESS_OPTIMIZATION` | 流程优化 | 工作流程、业务流程优化等 |
| `SERVICE_IMPROVEMENT` | 服务改进 | 客户服务、内部服务改进等 |
| `MANAGEMENT_INNOVATION` | 管理创新 | 管理方法、组织方式创新等 |
| `OTHER` | 其他 | 其他类型的创新想法 |

## 📊 数据结构

### 数据库表结构

在 `voice` 表中新增了 `idea_type` 字段：

```sql
ALTER TABLE voice ADD COLUMN idea_type TEXT;
```

**字段说明**：
- **字段名**：`idea_type`
- **数据类型**：`TEXT`（SQLite）或 `VARCHAR`（其他数据库）
- **是否可空**：是（NULL 表示未设置类型）
- **适用范围**：仅用于 `type = 'IDEA'` 的创意
- **索引**：已创建索引 `idx_voice_idea_type`（仅针对 IDEA 类型）

### Java 实体类

#### IdeaType 枚举

```java
public enum IdeaType {
    TECH_INNOVATION("技术创新"),
    PRODUCT_INNOVATION("产品创新"),
    PROCESS_OPTIMIZATION("流程优化"),
    SERVICE_IMPROVEMENT("服务改进"),
    MANAGEMENT_INNOVATION("管理创新"),
    OTHER("其他");
}
```

#### Voice 实体类

```java
public class Voice {
    // ... 其他字段
    private String ideaType;  // 创意类型（仅用于type='IDEA'）
    // ... 其他字段
}
```

#### VoiceDTO

```java
public class VoiceDTO {
    // ... 其他字段
    private IdeaType ideaType;  // 创意类型枚举
    // ... 其他字段
}
```

## 🔧 实现细节

### 1. 数据库迁移

**迁移文件**：`voice_community_backend/src/main/resources/db/migration/V20251230__add_idea_type.sql`

```sql
-- 为voice表添加idea_type字段
ALTER TABLE voice ADD COLUMN idea_type TEXT;

-- 创建索引以提高查询性能
CREATE INDEX IF NOT EXISTS idx_voice_idea_type ON voice(idea_type) WHERE type = 'IDEA';
```

### 2. MyBatis Mapper 更新

- ✅ 更新了 `insertVoice` 语句，包含 `idea_type` 字段
- ✅ 更新了所有 `resultMap`，添加 `idea_type` 字段映射
- ✅ 更新了所有查询语句，包含 `idea_type` 字段

### 3. 业务逻辑

- **适用范围**：仅当 `type = 'IDEA'` 时，`idea_type` 字段才有意义
- **默认值**：如果未设置，`idea_type` 为 `NULL`，前端可显示为"未分类"或"其他"
- **查询支持**：可以根据 `idea_type` 进行筛选和分类查询

## 📝 使用示例

### 创建创意时设置类型

```java
Voice voice = new Voice();
voice.setType("IDEA");
voice.setIdeaType("TECH_INNOVATION");  // 设置为技术创新
// ... 其他字段
voiceMapper.insertVoice(voice);
```

### 查询特定类型的创意

```sql
SELECT * FROM voice 
WHERE type = 'IDEA' 
  AND idea_type = 'TECH_INNOVATION'
  AND is_deleted = 0;
```

### 前端使用

```typescript
// TypeScript 枚举
enum IdeaType {
  TECH_INNOVATION = 'TECH_INNOVATION',
  PRODUCT_INNOVATION = 'PRODUCT_INNOVATION',
  PROCESS_OPTIMIZATION = 'PROCESS_OPTIMIZATION',
  SERVICE_IMPROVEMENT = 'SERVICE_IMPROVEMENT',
  MANAGEMENT_INNOVATION = 'MANAGEMENT_INNOVATION',
  OTHER = 'OTHER'
}

// 使用示例
const ideaTypeOptions = [
  { label: '技术创新', value: IdeaType.TECH_INNOVATION },
  { label: '产品创新', value: IdeaType.PRODUCT_INNOVATION },
  { label: '流程优化', value: IdeaType.PROCESS_OPTIMIZATION },
  { label: '服务改进', value: IdeaType.SERVICE_IMPROVEMENT },
  { label: '管理创新', value: IdeaType.MANAGEMENT_INNOVATION },
  { label: '其他', value: IdeaType.OTHER }
];
```

## 🔍 查询场景

### 1. 按类型统计创意数量

```sql
SELECT idea_type, COUNT(*) as count
FROM voice
WHERE type = 'IDEA' AND is_deleted = 0
GROUP BY idea_type;
```

### 2. 查询特定类型的创意列表

```sql
SELECT * FROM voice
WHERE type = 'IDEA' 
  AND idea_type = 'TECH_INNOVATION'
  AND is_deleted = 0
ORDER BY create_time DESC;
```

### 3. 按类型分组展示

可以在前端按类型分组展示创意，方便用户浏览和筛选。

## 📌 注意事项

1. **仅适用于 IDEA**：`idea_type` 字段仅对 `type = 'IDEA'` 的创意有意义，吐槽（GOSSIPING）不需要此字段。

2. **向后兼容**：
   - 现有数据中 `idea_type` 为 `NULL` 是正常的
   - 前端应处理 `NULL` 值，显示为"未分类"或"其他"

3. **索引优化**：
   - 已创建条件索引 `idx_voice_idea_type`，仅对 `type = 'IDEA'` 的记录建立索引
   - 提高按类型查询的性能

4. **数据迁移**：
   - 如果需要为现有数据设置默认类型，可以执行：
   ```sql
   UPDATE voice 
   SET idea_type = 'OTHER' 
   WHERE type = 'IDEA' AND idea_type IS NULL;
   ```

## 🚀 后续扩展

如果需要更灵活的类型管理，可以考虑：

1. **创建类型表**：将类型存储在独立的表中，支持动态添加和修改
2. **类型层级**：支持一级、二级分类
3. **类型权限**：某些类型可能需要特定权限才能创建
4. **类型统计**：在管理后台展示各类型的统计信息

## 📚 相关文件

### 后端文件
- `voice_community_backend/src/main/java/com/vc/pojo/entity/IdeaType.java` - 枚举定义
- `voice_community_backend/src/main/java/com/vc/pojo/entity/Voice.java` - 实体类
- `voice_community_backend/src/main/java/com/vc/pojo/dto/VoiceDTO.java` - DTO
- `voice_community_backend/src/main/java/com/vc/mapper/VoiceMapper.xml` - MyBatis Mapper
- `voice_community_backend/src/main/resources/db/migration/V20251230__add_idea_type.sql` - 数据库迁移

### 管理后台文件
- `voice_community_admin_backend/src/main/java/com/vc/admin/pojo/entity/Voice.java` - 管理后台实体类

---

**创建时间**：2025-12-30  
**版本**：v1.0

